/* Joe Pullifrone 
   09/19/2016
   IQN-34663

adding the following columns:   
is_vat_applied_on_base         NUMBER(1),
custom_expenditure_type_desc   VARCHAR2(254),
is_for_backoffice_reversal     NUMBER(1),
cac1_segment1_oid              NUMBER(38),
cac1_segment2_oid              NUMBER(38),
cac1_segment3_oid              NUMBER(38),
cac1_segment4_oid              NUMBER(38),
cac1_segment5_oid              NUMBER(38),
cac2_segment1_oid              NUMBER(38),
cac2_segment2_oid              NUMBER(38),
cac2_segment3_oid              NUMBER(38),
cac2_segment4_oid              NUMBER(38),
cac2_segment5_oid              NUMBER(38),
payment_amount                 NUMBER(38,2),
markup_amount                  NUMBER(38,2),
bill_amount                    NUMBER(38,2),
flexrate_buyer_base_amount     NUMBER(38,2),
flexrate_supplier_base_amount  NUMBER(38,2),
flexrate_mgmt_fee_base_amount  NUMBER(38,2),



All Custom Report queries use buyer_org_id and invoce_date
as filters. Partitioning in this way should improve partitioning
pruning significantly.

note: 5/2008 is the earliest month/year that has invoices in INVOICE table.

*/

BEGIN

  EXECUTE IMMEDIATE 'DROP TABLE lego_invoiced_expd_detail PURGE';
  
  DELETE FROM lego_invoice_approved
   WHERE object_name = 'LEGO_INVOICED_EXPD_DETAIL';
  COMMIT;
   
EXCEPTION  
  WHEN OTHERS THEN 
    NULL;
END;
/

CREATE TABLE lego_invoiced_expd_detail (
buyer_org_id                   NUMBER(38) NOT NULL,
supplier_org_id                NUMBER(38) NOT NULL,
invoice_id                     NUMBER(38) NOT NULL,
invoice_header_id              NUMBER(38) NOT NULL,
invoice_detail_id              NUMBER(38) NOT NULL,
invoice_date                   DATE NOT NULL,
invoice_create_date            DATE NOT NULL,               
expenditure_item_id            NUMBER(38) NOT NULL,
expenditure_number             VARCHAR2(24) NOT NULL,
expenditure_date               DATE NOT NULL,
week_ending_date               DATE NOT NULL,
assignment_continuity_id       NUMBER(38),                  
timecard_id                    NUMBER(38),
timecard_entry_id              NUMBER(38),  
assignment_bonus_id            NUMBER(38),
payment_request_id             NUMBER(38),
payment_request_invdtl_id      NUMBER(38),
expense_report_id              NUMBER(38),
expense_report_line_item_id    NUMBER(38),               
direct_hire_agmt_id            NUMBER(38),
project_agreement_id           NUMBER(38),               
milestone_invoice_id           NUMBER(38), 
milestone_invoice_detail_id    NUMBER(38),
candidate_id                   NUMBER(38),
candidate_name                 VARCHAR2(300),      
hiring_mgr_person_id           NUMBER(38),
hiring_mgr_name                VARCHAR2(300),
sar_person_id                  NUMBER(38),
sar_name                       VARCHAR2(300),
org_sub_classification         VARCHAR2(256),
customer_supplier_internal_id  VARCHAR2(128),
accounting_code                VARCHAR2(500),
buyer_resource_id              VARCHAR2(64),
ap_invoice_number              VARCHAR2(128),
is_vat_applied_on_fee          NUMBER(1),  
is_vat_applied_on_base         NUMBER(1),        
buyer_fee                      NUMBER(38,2), 
supplier_fee                   NUMBER(38,2),    
flexrate_mgmt_fee_amount       NUMBER(38,2),
buyer_fee_calc_percent         NUMBER(38,2),
supplier_fee_calc_percent      NUMBER(38,2),                    
flexrate_type                  VARCHAR2(24),
invoice_transaction_type       VARCHAR2(64),
expense_type_name              VARCHAR2(64),
payment_type_name              VARCHAR2(64),
invalidating_event_desc_id     NUMBER(38),  
reversed_expenditure_txn_id    NUMBER(38),
invoiceable_mgmt_fee_txn_id    NUMBER(38),
custom_expenditure_type_id     NUMBER(38),
custom_expenditure_type_desc   VARCHAR2(254),
partial_rate_percent           NUMBER(38,2),
flexrate_exp_type_name         VARCHAR2(64),
service_id                     NUMBER(38),
service_identifier             VARCHAR2(64),
service_exp_type_desc          VARCHAR2(64),
service_exp_type_id            NUMBER(38),
purchase_order                 VARCHAR2(64),
supplier_reference_num         VARCHAR2(64),
debit_credit_indicator         NUMBER(1),
project_number                 VARCHAR2(500), 
buyer_bus_org_bill_to_addr_id  NUMBER(38),                     
buyer_taxable_country_id       NUMBER(38),
buyer_bus_org_tax_id           VARCHAR2(64),
supplier_bus_org_tax_id        VARCHAR2(64),
supplier_taxable_country_id    NUMBER(38),
is_iqn_mgmt_fee_payee          NUMBER(1), 
is_for_backoffice_reversal     NUMBER(1), 
cac1_segment1_value            VARCHAR2(150),
cac1_segment2_value            VARCHAR2(150),
cac1_segment3_value            VARCHAR2(150),
cac1_segment4_value            VARCHAR2(150),
cac1_segment5_value            VARCHAR2(150),
cac2_segment1_value            VARCHAR2(150),
cac2_segment2_value            VARCHAR2(150),
cac2_segment3_value            VARCHAR2(150),
cac2_segment4_value            VARCHAR2(150),
cac2_segment5_value            VARCHAR2(150),            
cac1_oid                       VARCHAR2(500),
cac2_oid                       VARCHAR2(500),
rate_unit_id                   NUMBER(38),
rate_identifier_id             NUMBER(38),
rate_identifier_name           VARCHAR2(64),
base_bill_rate                 NUMBER(38,2),
base_pay_rate                  NUMBER(38,2),
buyer_adjusted_bill_rate       NUMBER(38,2),
supplier_reimbursement_rate    NUMBER(38,2),
flexrate_buyer_rate            NUMBER(38,2),
flexrate_supplier_rate         NUMBER(38,2), 
quantity                       NUMBER(38,2),
payment_amount                 NUMBER(38,2),
markup_amount                  NUMBER(38,2),
bill_amount                    NUMBER(38,2),
buyer_adjusted_amount          NUMBER(38,2),
supplier_reimbursement_amount  NUMBER(38,2),
flexrate_buyer_base_amount     NUMBER(38,2),
flexrate_buyer_amount          NUMBER(38,2),
flexrate_supplier_base_amount  NUMBER(38,2),
flexrate_supplier_amount       NUMBER(38,2),
flexrate_mgmt_fee_base_amount  NUMBER(38,2),
curr_conv_info_id              NUMBER(38),
currency                       VARCHAR2(64),
owning_buyer_org_id            NUMBER(38) NOT NULL,
buyer_enterprise_bus_org_id    NUMBER(38) NOT NULL,
source_name                    VARCHAR2(24) NOT NULL,
load_date                      DATE NOT NULL)         
  PARTITION BY LIST (buyer_org_id)    
  SUBPARTITION BY RANGE (invoice_date)
  SUBPARTITION TEMPLATE(
    SUBPARTITION P_LT_Q2_2008 VALUES LESS THAN (TO_DATE('04/01/2008','MM/DD/YYYY')),             
    SUBPARTITION P_Q2_2008 VALUES LESS THAN (TO_DATE('07/01/2008','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2008 VALUES LESS THAN (TO_DATE('10/01/2008','MM/DD/YYYY')),        
    SUBPARTITION P_Q4_2008 VALUES LESS THAN (TO_DATE('01/01/2009','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2009 VALUES LESS THAN (TO_DATE('04/01/2009','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2009 VALUES LESS THAN (TO_DATE('07/01/2009','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2009 VALUES LESS THAN (TO_DATE('10/01/2009','MM/DD/YYYY')),         
    SUBPARTITION P_Q4_2009 VALUES LESS THAN (TO_DATE('01/01/2010','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2010 VALUES LESS THAN (TO_DATE('04/01/2010','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2010 VALUES LESS THAN (TO_DATE('07/01/2010','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2010 VALUES LESS THAN (TO_DATE('10/01/2010','MM/DD/YYYY')),        
    SUBPARTITION P_Q4_2010 VALUES LESS THAN (TO_DATE('01/01/2011','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2011 VALUES LESS THAN (TO_DATE('04/01/2011','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2011 VALUES LESS THAN (TO_DATE('07/01/2011','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2011 VALUES LESS THAN (TO_DATE('10/01/2011','MM/DD/YYYY')),       
    SUBPARTITION P_Q4_2011 VALUES LESS THAN (TO_DATE('01/01/2012','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2012 VALUES LESS THAN (TO_DATE('04/01/2012','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2012 VALUES LESS THAN (TO_DATE('07/01/2012','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2012 VALUES LESS THAN (TO_DATE('10/01/2012','MM/DD/YYYY')),    
    SUBPARTITION P_Q4_2012 VALUES LESS THAN (TO_DATE('01/01/2013','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2013 VALUES LESS THAN (TO_DATE('04/01/2013','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2013 VALUES LESS THAN (TO_DATE('07/01/2013','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2013 VALUES LESS THAN (TO_DATE('10/01/2013','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2013 VALUES LESS THAN (TO_DATE('01/01/2014','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2014 VALUES LESS THAN (TO_DATE('04/01/2014','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2014 VALUES LESS THAN (TO_DATE('07/01/2014','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2014 VALUES LESS THAN (TO_DATE('10/01/2014','MM/DD/YYYY')),      
    SUBPARTITION P_Q4_2014 VALUES LESS THAN (TO_DATE('01/01/2015','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2015 VALUES LESS THAN (TO_DATE('04/01/2015','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2015 VALUES LESS THAN (TO_DATE('07/01/2015','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2015 VALUES LESS THAN (TO_DATE('10/01/2015','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2015 VALUES LESS THAN (TO_DATE('01/01/2016','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2016 VALUES LESS THAN (TO_DATE('04/01/2016','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2016 VALUES LESS THAN (TO_DATE('07/01/2016','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2016 VALUES LESS THAN (TO_DATE('10/01/2016','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2016 VALUES LESS THAN (TO_DATE('01/01/2017','MM/DD/YYYY')),    
    SUBPARTITION P_Q1_2017 VALUES LESS THAN (TO_DATE('04/01/2017','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2017 VALUES LESS THAN (TO_DATE('07/01/2017','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2017 VALUES LESS THAN (TO_DATE('10/01/2017','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2017 VALUES LESS THAN (TO_DATE('01/01/2018','MM/DD/YYYY')),   
    SUBPARTITION P_Q1_2018 VALUES LESS THAN (TO_DATE('04/01/2018','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2018 VALUES LESS THAN (TO_DATE('07/01/2018','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2018 VALUES LESS THAN (TO_DATE('10/01/2018','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2018 VALUES LESS THAN (TO_DATE('01/01/2019','MM/DD/YYYY')), 
    SUBPARTITION P_Q1_2019 VALUES LESS THAN (TO_DATE('04/01/2019','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2019 VALUES LESS THAN (TO_DATE('07/01/2019','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2019 VALUES LESS THAN (TO_DATE('10/01/2019','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2019 VALUES LESS THAN (TO_DATE('01/01/2020','MM/DD/YYYY')),    
    SUBPARTITION P_Q1_2020 VALUES LESS THAN (TO_DATE('04/01/2020','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2020 VALUES LESS THAN (TO_DATE('07/01/2020','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2020 VALUES LESS THAN (TO_DATE('10/01/2020','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2020 VALUES LESS THAN (TO_DATE('01/01/2021','MM/DD/YYYY')),
    SUBPARTITION P_Q1_2021 VALUES LESS THAN (TO_DATE('04/01/2021','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2021 VALUES LESS THAN (TO_DATE('07/01/2021','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2021 VALUES LESS THAN (TO_DATE('10/01/2021','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2021 VALUES LESS THAN (TO_DATE('01/01/2022','MM/DD/YYYY')),    
    SUBPARTITION P_Q1_2022 VALUES LESS THAN (TO_DATE('04/01/2022','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2022 VALUES LESS THAN (TO_DATE('07/01/2022','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2022 VALUES LESS THAN (TO_DATE('10/01/2022','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2022 VALUES LESS THAN (TO_DATE('01/01/2023','MM/DD/YYYY')), 
    SUBPARTITION P_Q1_2023 VALUES LESS THAN (TO_DATE('04/01/2023','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2023 VALUES LESS THAN (TO_DATE('07/01/2023','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2023 VALUES LESS THAN (TO_DATE('10/01/2023','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2023 VALUES LESS THAN (TO_DATE('01/01/2024','MM/DD/YYYY')),       
    SUBPARTITION P_Q1_2024 VALUES LESS THAN (TO_DATE('04/01/2024','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2024 VALUES LESS THAN (TO_DATE('07/01/2024','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2024 VALUES LESS THAN (TO_DATE('10/01/2024','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2024 VALUES LESS THAN (TO_DATE('01/01/2025','MM/DD/YYYY')), 
    SUBPARTITION P_Q1_2025 VALUES LESS THAN (TO_DATE('04/01/2025','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2025 VALUES LESS THAN (TO_DATE('07/01/2025','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2025 VALUES LESS THAN (TO_DATE('10/01/2025','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2025 VALUES LESS THAN (TO_DATE('01/01/2026','MM/DD/YYYY')),         
    SUBPARTITION P_Q1_2026 VALUES LESS THAN (TO_DATE('04/01/2026','MM/DD/YYYY')),
    SUBPARTITION P_Q2_2026 VALUES LESS THAN (TO_DATE('07/01/2026','MM/DD/YYYY')),
    SUBPARTITION P_Q3_2026 VALUES LESS THAN (TO_DATE('10/01/2026','MM/DD/YYYY')),
    SUBPARTITION P_Q4_2026 VALUES LESS THAN (TO_DATE('01/01/2027','MM/DD/YYYY'))           
    )
 (PARTITION P_NULL VALUES (NULL))
/
